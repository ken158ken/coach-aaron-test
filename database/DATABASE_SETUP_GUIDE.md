# Supabase è³‡æ–™åº«è¨­å®šæŒ‡å—

## ğŸ” å•é¡Œè¨ºæ–·

æ‚¨é‡åˆ°çš„å•é¡Œï¼š

- âœ… `seed.sql` åŸ·è¡ŒæˆåŠŸä½† "No rows returned"
- âŒ `schema.sql` å ±éŒ¯ï¼šæ”¿ç­–å·²å­˜åœ¨

**åŸå› **ï¼šè³‡æ–™åº«å¯èƒ½å·²ç¶“éƒ¨åˆ†å»ºç«‹ï¼Œ`ON CONFLICT DO NOTHING` å°è‡´è³‡æ–™æ²’æœ‰æ’å…¥ã€‚

---

## ğŸ“‹ è§£æ±ºæ–¹æ¡ˆï¼ˆä¸‰é¸ä¸€ï¼‰

### æ–¹æ¡ˆä¸€ï¼šæª¢æŸ¥è³‡æ–™æ˜¯å¦å·²å­˜åœ¨ï¼ˆæ¨è–¦å…ˆåŸ·è¡Œï¼‰

1. å‰å¾€ [Supabase Dashboard](https://app.supabase.com/)
2. é¸æ“‡æ‚¨çš„å°ˆæ¡ˆ
3. é»é¸å·¦å´ **SQL Editor**
4. é»é¸ **New query**
5. è¤‡è£½è²¼ä¸Š `database/check_data.sql` çš„å…§å®¹
6. é»é¸ **Run** åŸ·è¡Œ

**é æœŸçµæœ**ï¼š

- å¦‚æœçœ‹åˆ° 3 ç­†èª²ç¨‹ã€18 ç­†å½±ç‰‡ â†’ âœ… è³‡æ–™å·²å­˜åœ¨ï¼Œä¸éœ€è¦é‡æ–°åŸ·è¡Œ
- å¦‚æœçœ‹åˆ° 0 ç­† â†’ âš ï¸ éœ€è¦åŸ·è¡Œæ–¹æ¡ˆäºŒæˆ–æ–¹æ¡ˆä¸‰

---

### æ–¹æ¡ˆäºŒï¼šå¼·åˆ¶æ’å…¥è³‡æ–™ï¼ˆä¿ç•™è¡¨çµæ§‹ï¼‰

**é©ç”¨æƒ…æ³**ï¼šè¡¨çµæ§‹å·²å»ºç«‹ï¼Œä½†è³‡æ–™æ²’é€²å»

#### æ­¥é©Ÿï¼š

1. åœ¨ Supabase SQL Editor åŸ·è¡Œ `database/force_insert_data.sql`
2. æŸ¥çœ‹æœ€å¾Œçš„é©—è­‰çµæœï¼š
   ```
   ç®¡ç†å“¡ç™½åå–®: 1
   èª²ç¨‹: 3
   å½±ç‰‡: 18
   ä½¿ç”¨è€…: 0
   ```

**å„ªé»**ï¼šå¿«é€Ÿï¼Œä¸æœƒåˆªé™¤è¡¨çµæ§‹  
**ç¼ºé»**ï¼šå¦‚æœè¡¨çµæ§‹æœ‰èª¤ï¼Œç„¡æ³•ä¿®æ­£

---

### æ–¹æ¡ˆä¸‰ï¼šå®Œå…¨é‡ç½®è³‡æ–™åº«ï¼ˆå¾é›¶é–‹å§‹ï¼‰

**é©ç”¨æƒ…æ³**ï¼šè¡¨çµæ§‹æœ‰å•é¡Œï¼Œæˆ–æƒ³è¦ä¹¾æ·¨çš„ç’°å¢ƒ

#### âš ï¸ è­¦å‘Šï¼šé€™æœƒåˆªé™¤æ‰€æœ‰è³‡æ–™ï¼

#### æ­¥é©Ÿï¼š

```sql
-- 1. åŸ·è¡Œ reset_database.sqlï¼ˆæ¸…ç©ºæ‰€æœ‰è¡¨å’Œæ”¿ç­–ï¼‰
-- åœ¨ Supabase SQL Editor åŸ·è¡Œæ­¤æª”æ¡ˆ

-- 2. åŸ·è¡Œ schema.sqlï¼ˆé‡å»ºè¡¨çµæ§‹ï¼‰
-- åœ¨ Supabase SQL Editor åŸ·è¡Œæ­¤æª”æ¡ˆ

-- 3. åŸ·è¡Œ force_insert_data.sqlï¼ˆæ’å…¥è³‡æ–™ï¼‰
-- åœ¨ Supabase SQL Editor åŸ·è¡Œæ­¤æª”æ¡ˆ
```

**åŸ·è¡Œé †åº**ï¼š

```
reset_database.sql â†’ schema.sql â†’ force_insert_data.sql
```

---

## ğŸ¯ å¿«é€Ÿé©—è­‰æŒ‡ä»¤

åœ¨ Supabase SQL Editor åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤å¿«é€Ÿæª¢æŸ¥ï¼š

```sql
-- æª¢æŸ¥èª²ç¨‹
SELECT COUNT(*) as course_count FROM public.courses;
SELECT course_title, price FROM public.courses;

-- æª¢æŸ¥å½±ç‰‡
SELECT COUNT(*) as video_count FROM public.videos;
SELECT title, sort_order FROM public.videos LIMIT 5;

-- æª¢æŸ¥ç®¡ç†å“¡
SELECT email, is_active FROM public.admin_whitelist;
```

---

## ğŸ“Š é æœŸçµæœ

### æ­£ç¢ºçš„è³‡æ–™åº«ç‹€æ…‹ï¼š

| è¡¨å              | ç­†æ•¸ | èªªæ˜                           |
| ----------------- | ---- | ------------------------------ |
| `admin_whitelist` | 1    | ken158ken@gmail.com            |
| `courses`         | 3    | åˆå­¸è€…å…¨èº«ç‡ƒè„‚ã€HIITã€è…¹è‚Œè¨“ç·´ |
| `videos`          | 18   | Instagram Reels                |
| `users`           | 0    | åˆå§‹ç„¡ä½¿ç”¨è€…ï¼ˆè¨»å†Šå¾Œæœƒæœ‰ï¼‰     |
| `orders`          | 0    | åˆå§‹ç„¡è¨‚å–®                     |

### èª²ç¨‹è³‡æ–™ï¼š

```
course_id | course_title          | price
----------+-----------------------+-------
1         | åˆå­¸è€…å…¨èº«ç‡ƒè„‚         | 999
2         | é«˜å¼·åº¦é–“æ­‡è¨“ç·´ (HIIT) | 1299
3         | å±…å®¶è…¹è‚Œè¨“ç·´           | 799
```

### å½±ç‰‡è³‡æ–™ï¼ˆå‰ 5 ç­†ï¼‰ï¼š

```
video_id | title              | sort_order
---------+--------------------+-----------
1        | ğŸ’ª æ•™ç·´æ—¥å¸¸è¨“ç·´     | 1
2        | ğŸ§  å¥èº«å¿ƒç†å­¸åˆ†äº«   | 2
3        | ğŸ“š è¨“ç·´æŠ€å·§æ•™å­¸     | 3
4        | ğŸ‹ï¸ å¥èº«å‹•ä½œç¤ºç¯„     | 4
5        | ğŸ’¡ é‹å‹•çŸ¥è­˜åˆ†äº«     | 5
```

---

## ğŸš¨ å¸¸è¦‹éŒ¯èª¤è™•ç†

### éŒ¯èª¤ 1: "policy already exists"

**åŸå› **ï¼šRLS æ”¿ç­–å·²å»ºç«‹  
**è§£æ±º**ï¼šåŸ·è¡Œ `reset_database.sql` æ¸…é™¤æ”¿ç­–

### éŒ¯èª¤ 2: "relation does not exist"

**åŸå› **ï¼šè¡¨å°šæœªå»ºç«‹  
**è§£æ±º**ï¼šå…ˆåŸ·è¡Œ `schema.sql`

### éŒ¯èª¤ 3: "permission denied"

**åŸå› **ï¼šRLS æ”¿ç­–é˜»æ“‹  
**è§£æ±º**ï¼šä½¿ç”¨ SQL Editorï¼ˆè‡ªå‹•ä½¿ç”¨ service_roleï¼‰

### éŒ¯èª¤ 4: "No rows returned"

**åŸå› **ï¼šINSERT æ™‚ä½¿ç”¨äº† `ON CONFLICT DO NOTHING`ï¼Œè³‡æ–™å·²å­˜åœ¨  
**è§£æ±º**ï¼šåŸ·è¡Œ `check_data.sql` ç¢ºèªè³‡æ–™æ˜¯å¦å·²å­˜åœ¨

---

## ğŸ”§ æˆ‘çš„å»ºè­°åŸ·è¡Œé †åº

### å¦‚æœæ‚¨æ˜¯ç¬¬ä¸€æ¬¡è¨­å®šï¼š

```bash
1. åŸ·è¡Œ check_data.sql        # æª¢æŸ¥ç¾ç‹€
2. åŸ·è¡Œ reset_database.sql    # æ¸…ç©ºï¼ˆå¦‚æœæœ‰èˆŠè³‡æ–™ï¼‰
3. åŸ·è¡Œ schema.sql            # å»ºç«‹çµæ§‹
4. åŸ·è¡Œ force_insert_data.sql # æ’å…¥è³‡æ–™
5. å†æ¬¡åŸ·è¡Œ check_data.sql    # é©—è­‰çµæœ
```

### å¦‚æœè¡¨å·²å»ºç«‹ä½†è³‡æ–™ä¸å®Œæ•´ï¼š

```bash
1. åŸ·è¡Œ force_insert_data.sql # å¼·åˆ¶æ’å…¥
2. åŸ·è¡Œ check_data.sql        # é©—è­‰çµæœ
```

---

## ğŸ“ æª¢æŸ¥æ¸…å–®

åŸ·è¡Œå®Œæˆå¾Œç¢ºèªï¼š

- [ ] `courses` è¡¨æœ‰ 3 ç­†è³‡æ–™
- [ ] `videos` è¡¨æœ‰ 18 ç­†è³‡æ–™
- [ ] `admin_whitelist` æœ‰ ken158ken@gmail.com
- [ ] `users` è¡¨çš„ `password_hash` æ¬„ä½å­˜åœ¨
- [ ] RLS æ”¿ç­–å·²å•Ÿç”¨ï¼ˆ9 å€‹æ”¿ç­–ï¼‰
- [ ] ç´¢å¼•å·²å»ºç«‹

---

## ğŸ‰ å®Œæˆå¾Œæ¸¬è©¦

1. **å•Ÿå‹•å°ˆæ¡ˆ**ï¼š

   ```bash
   npm start
   ```

2. **æ¸¬è©¦è¨»å†Š**ï¼š

   - å‰å¾€ http://localhost:5173/register
   - è¨»å†Šæ–°å¸³è™Ÿ

3. **æª¢æŸ¥è³‡æ–™åº«**ï¼š

   ```sql
   SELECT username, email, sex, is_active FROM public.users;
   ```

4. **æ¸¬è©¦ç®¡ç†å“¡ç™»å…¥**ï¼š
   - ä½¿ç”¨ ken158ken@gmail.com è¨»å†Š/ç™»å…¥
   - é€²å…¥æœƒå“¡ä¸­å¿ƒæ‡‰è©²çœ‹åˆ°ã€Œç®¡ç†å“¡å…¥å£ã€

---

## ğŸ“ éœ€è¦å¹«åŠ©ï¼Ÿ

å¦‚æœä»æœ‰å•é¡Œï¼Œè«‹æä¾›ï¼š

1. `check_data.sql` çš„åŸ·è¡Œçµæœ
2. å®Œæ•´çš„éŒ¯èª¤è¨Šæ¯æˆªåœ–
3. Supabase å°ˆæ¡ˆçš„ PostgreSQL ç‰ˆæœ¬

---

**æ›´æ–°æ™‚é–“**: 2026-01-13T00:00:00Z
